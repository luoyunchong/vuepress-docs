<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="referrer" content="never">
    <title>FreeSql+ASP.NET Core</title>
    <meta name="description" content="">
    <link rel="icon" href="/vuepress-docs/logo.png">
    
    <link rel="preload" href="/vuepress-docs/assets/css/styles.3e2b6cdf.css" as="style"><link rel="preload" href="/vuepress-docs/assets/js/app.3e2b6cdf.js" as="script"><link rel="preload" href="/vuepress-docs/assets/js/13.3d6fab59.js" as="script"><link rel="prefetch" href="/vuepress-docs/assets/css/2.styles.c545940f.css"><link rel="prefetch" href="/vuepress-docs/assets/css/3.styles.5194c445.css"><link rel="prefetch" href="/vuepress-docs/assets/css/4.styles.6c1c8010.css"><link rel="prefetch" href="/vuepress-docs/assets/css/5.styles.82af18d5.css"><link rel="prefetch" href="/vuepress-docs/assets/js/1.e59787bb.js"><link rel="prefetch" href="/vuepress-docs/assets/js/10.75399a4c.js"><link rel="prefetch" href="/vuepress-docs/assets/js/11.99428eed.js"><link rel="prefetch" href="/vuepress-docs/assets/js/12.e347ef4f.js"><link rel="prefetch" href="/vuepress-docs/assets/js/14.e57950f3.js"><link rel="prefetch" href="/vuepress-docs/assets/js/15.0c7e7dc0.js"><link rel="prefetch" href="/vuepress-docs/assets/js/16.16079ac3.js"><link rel="prefetch" href="/vuepress-docs/assets/js/2.c545940f.js"><link rel="prefetch" href="/vuepress-docs/assets/js/3.5194c445.js"><link rel="prefetch" href="/vuepress-docs/assets/js/4.6c1c8010.js"><link rel="prefetch" href="/vuepress-docs/assets/js/5.82af18d5.js"><link rel="prefetch" href="/vuepress-docs/assets/js/6.b2b3f2de.js"><link rel="prefetch" href="/vuepress-docs/assets/js/7.ee9fe090.js"><link rel="prefetch" href="/vuepress-docs/assets/js/8.0ebb6ee4.js"><link rel="prefetch" href="/vuepress-docs/assets/js/9.a3d93902.js">
    <link rel="stylesheet" href="/vuepress-docs/assets/css/styles.3e2b6cdf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" style="position:relative;"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="home-link router-link-active"><img src="/vuepress-docs/left-logo.png" alt="" class="logo"> <!----></div> <div class="search" style="max-width:-300px;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" placeholder="回车搜索" value=""> <!----></div></div> <div class="links" style="max-width:-300px;"><nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-docs/dotnetcore/examples/" class="nav-link router-link-active">dotnetcore指南</a></div><div class="nav-item"><a href="/vuepress-docs/colorui/docs/" class="nav-link">ColorUI指南</a></div><div class="nav-item"><a href="https://github.com/luoyunchong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-docs/dotnetcore/examples/" class="nav-link router-link-active">dotnetcore指南</a></div><div class="nav-item"><a href="/vuepress-docs/colorui/docs/" class="nav-link">ColorUI指南</a></div><div class="nav-item"><a href="https://github.com/luoyunchong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>Examples</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/vuepress-docs/dotnetcore/examples/Console-Hello-World.html" class="sidebar-link">创建简单Hello World</a></li><li><a href="/vuepress-docs/dotnetcore/examples/Console-News-Types.html" class="sidebar-link">.NET Core 简单测试项目</a></li><li><a href="/vuepress-docs/dotnetcore/examples/FreeSql-in-asp.net-core-webapi-how-to-use.html" class="active sidebar-link">FreeSql+ASP.NET Core</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-docs/dotnetcore/examples/FreeSql-in-asp.net-core-webapi-how-to-use.html#文章概述" class="sidebar-link">文章概述</a></li><li class="sidebar-sub-header"><a href="/vuepress-docs/dotnetcore/examples/FreeSql-in-asp.net-core-webapi-how-to-use.html#freesql-简介" class="sidebar-link">FreeSql 简介</a></li><li class="sidebar-sub-header"><a href="/vuepress-docs/dotnetcore/examples/FreeSql-in-asp.net-core-webapi-how-to-use.html#install" class="sidebar-link">Install</a></li><li class="sidebar-sub-header"><a href="/vuepress-docs/dotnetcore/examples/FreeSql-in-asp.net-core-webapi-how-to-use.html#code-first" class="sidebar-link">code first</a></li><li class="sidebar-sub-header"><a href="/vuepress-docs/dotnetcore/examples/FreeSql-in-asp.net-core-webapi-how-to-use.html#db-first" class="sidebar-link">db first</a></li><li class="sidebar-sub-header"><a href="/vuepress-docs/dotnetcore/examples/FreeSql-in-asp.net-core-webapi-how-to-use.html#开始" class="sidebar-link">开始</a></li></ul></li><li><a href="/vuepress-docs/dotnetcore/examples/FreeSql-sample-blog-RESTful-use-automapper.html" class="sidebar-link">RESTful+FreeSql+AutoMapper</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-docs/dotnetcore/examples/FreeSql-sample-blog-RESTful-use-automapper.html#文章概述" class="sidebar-link">文章概述</a></li><li class="sidebar-sub-header"><a href="/vuepress-docs/dotnetcore/examples/FreeSql-sample-blog-RESTful-use-automapper.html#dto作用" class="sidebar-link">Dto作用</a></li><li class="sidebar-sub-header"><a href="/vuepress-docs/dotnetcore/examples/FreeSql-sample-blog-RESTful-use-automapper.html#automapper" class="sidebar-link">AutoMapper</a></li></ul></li><li><a href="/vuepress-docs/dotnetcore/examples/IdentityServer4.html" class="sidebar-link">IdentityServer4</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul></div> <div id="area" class="page"> <div class="content"><h1 id="freesql-asp-net-core"><a href="#freesql-asp-net-core" aria-hidden="true" class="header-anchor">#</a> FreeSql+ASP.NET Core</h1> <h2 id="文章概述"><a href="#文章概述" aria-hidden="true" class="header-anchor">#</a> 文章概述</h2> <p>主要在介绍FreeSql在ASP.NTE Core WebApi中如何使用的过程，完成一个最简单的博客系统的后端接口。</p> <h2 id="freesql-简介"><a href="#freesql-简介" aria-hidden="true" class="header-anchor">#</a> FreeSql 简介</h2> <p>国人写的一个功能强大的ORM,FreeSql 支持 MySql/SqlServer/PostgreSQL/Oracle/Sqlite，特点：轻量级、可扩展、基于 .NET Standard 跨平台。</p> <h3 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h3> <ul><li><p>FreeSql github <a href="https://github.com/2881099/FreeSql" target="_blank" rel="noopener noreferrer">https://github.com/2881099/FreeSql<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://docs.microsoft.com/zh-cn/dotnet/core/tools/dotnet-new?tabs=netcore22" target="_blank" rel="noopener noreferrer">关于.net core cli中如何使用dotnet new<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://docs.microsoft.com/zh-cn/aspnet/core/web-api/?view=aspnetcore-2.2" target="_blank" rel="noopener noreferrer">使用 ASP.NET Core 创建 Web API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://docs.microsoft.com/zh-cn/aspnet/core/tutorials/web-api-help-pages-using-swagger?view=aspnetcore-2.2" target="_blank" rel="noopener noreferrer">Swagger/OpenAPI 生成接口文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://github.com/domaindrivendev/Swashbuckle.AspNetCore" target="_blank" rel="noopener noreferrer">Swagger GitHub (Swashbuckle.AspNetCore)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h3 id="项目准备"><a href="#项目准备" aria-hidden="true" class="header-anchor">#</a> 项目准备</h3> <ul><li>Mysql 5.6</li> <li>Visual Studio 2019或2017、Visual Studio code</li> <li>.NET Core 2.2+</li> <li>PowerShell</li> <li>懂点mvc，该教程不会教你如何使用 ASP .NET Core MVC、RESTful</li></ul> <p>创建一个webapi 的项目，起名为RESTful.FreeSql</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> dotnetcore<span class="token operator">-</span>examples\asp<span class="token punctuation">.</span>net<span class="token operator">-</span>core<span class="token operator">-</span>freesql&gt; dotnet new webapi <span class="token operator">-</span>n RESTful<span class="token punctuation">.</span>FreeSql
The template <span class="token string">&quot;ASP.NET Core Web API&quot;</span> was created successfully<span class="token punctuation">.</span>
<span class="token function">PS</span> dotnetcore<span class="token operator">-</span>examples\asp<span class="token punctuation">.</span>net<span class="token operator">-</span>core<span class="token operator">-</span>freesql&gt; cd <span class="token punctuation">.</span>\RESTful<span class="token punctuation">.</span>FreeSql\
<span class="token function">PS</span> dotnetcore<span class="token operator">-</span>examples\asp<span class="token punctuation">.</span>net<span class="token operator">-</span>core<span class="token operator">-</span>freesql\RESTful<span class="token punctuation">.</span>FreeSql&gt; dotnet run

info: Microsoft<span class="token punctuation">.</span>Hosting<span class="token punctuation">.</span>Lifetime<span class="token punctuation">[</span>0<span class="token punctuation">]</span>
      Now listening on: https:<span class="token operator">/</span><span class="token operator">/</span>localhost:5001
info: Microsoft<span class="token punctuation">.</span>Hosting<span class="token punctuation">.</span>Lifetime<span class="token punctuation">[</span>0<span class="token punctuation">]</span>
      Now listening on: http:<span class="token operator">/</span><span class="token operator">/</span>localhost:5000
info: Microsoft<span class="token punctuation">.</span>Hosting<span class="token punctuation">.</span>Lifetime<span class="token punctuation">[</span>0<span class="token punctuation">]</span>
      Application started<span class="token punctuation">.</span> Press Ctrl<span class="token operator">+</span>C to shut down<span class="token punctuation">.</span>
info: Microsoft<span class="token punctuation">.</span>Hosting<span class="token punctuation">.</span>Lifetime<span class="token punctuation">[</span>0<span class="token punctuation">]</span>
      Hosting environment: Development
info: Microsoft<span class="token punctuation">.</span>Hosting<span class="token punctuation">.</span>Lifetime<span class="token punctuation">[</span>0<span class="token punctuation">]</span>
      Content root path: D:\code\github\dotnetcore<span class="token operator">-</span>examples\asp<span class="token punctuation">.</span>net<span class="token operator">-</span>core<span class="token operator">-</span>freesql\RESTful<span class="token punctuation">.</span>FreeSql
</code></pre></div><p>打开浏览器 https://localhost:5001 会出现404</p> <p>请打开这个地址 https://localhost:5001/api/values ，可看到如下内容。</p> <div class="language- extra-class"><pre class="language-text"><code>[&quot;value1&quot;,&quot;value2&quot;]
</code></pre></div><p>接下来我们来集成FreeSql，我们以最简单的命令和说明，详细内容去官网看具体内容</p> <ul><li>官网文档 <a href="http://freesql.net/doc" target="_blank" rel="noopener noreferrer">http://freesql.net/doc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="install"><a href="#install" aria-hidden="true" class="header-anchor">#</a> Install</h2> <p>要先cd到RESTful.FreeSql目录中。</p> <div class="language-PowerShell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> \asp<span class="token punctuation">.</span>net<span class="token operator">-</span>core<span class="token operator">-</span>freesql\RESTful<span class="token punctuation">.</span>FreeSql&gt; dotnet add package FreeSql
<span class="token function">PS</span> \asp<span class="token punctuation">.</span>net<span class="token operator">-</span>core<span class="token operator">-</span>freesql\RESTful<span class="token punctuation">.</span>FreeSql&gt; dotnet add package FreeSql<span class="token punctuation">.</span>Provider<span class="token punctuation">.</span>MySql
</code></pre></div><h2 id="code-first"><a href="#code-first" aria-hidden="true" class="header-anchor">#</a> code first</h2> <ul><li><a href="https://github.com/2881099/FreeSql/blob/master/Docs/codefirst.md" target="_blank" rel="noopener noreferrer">关于CodeFirst，官方文档的介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>代码优先，使用过EntityFramework的应该很清楚这一概念，我的理解就是：在分析数据库表关系时，不通过在数据库中设计表，而是直接在代码中声明对应的类，使用导航属性代替外键关联，通过数据表字段与C#中的类库对应，从而自动生成数据表。</p> <h2 id="db-first"><a href="#db-first" aria-hidden="true" class="header-anchor">#</a> db first</h2> <p>数据库优先：需求分析后，直接设计数据库，通过数据库中的表，直接生成代码，类。</p> <h2 id="开始"><a href="#开始" aria-hidden="true" class="header-anchor">#</a> 开始</h2> <h3 id="分析需求"><a href="#分析需求" aria-hidden="true" class="header-anchor">#</a> 分析需求</h3> <p>我们以code first 为示例，学习如何使用freesql，实现一个简单的博客。将表内容分为博客表（Blog)和评论表（Post)</p> <h4 id="blog-表"><a href="#blog-表" aria-hidden="true" class="header-anchor">#</a> Blog 表</h4> <table><thead><tr><th>字段名</th> <th>字段类型</th> <th>说明</th></tr></thead> <tbody><tr><td>BlogId</td> <td>int</td> <td>博客id</td></tr> <tr><td>Title</td> <td>varchar(50)</td> <td>博客标题</td></tr> <tr><td>Content</td> <td>varchar(500)</td> <td>博客内容</td></tr> <tr><td>CreateTime</td> <td>DateTime</td> <td>发布时间</td></tr></tbody></table> <h4 id="post-表"><a href="#post-表" aria-hidden="true" class="header-anchor">#</a> Post 表</h4> <table><thead><tr><th>字段名</th> <th>字段类型</th> <th>说明</th></tr></thead> <tbody><tr><td>PostId</td> <td>int</td> <td>评论id</td></tr> <tr><td>ReplyContent</td> <td>varchar(50)</td> <td>标题</td></tr> <tr><td>BlogId</td> <td>int</td> <td>博客id</td></tr> <tr><td>ReplyTime</td> <td>DateTime</td> <td>回复时间</td></tr></tbody></table> <p>建一个Domain文件夹,用于存放数据库表中对应的实体类。</p> <h3 id="关于"><a href="#关于" aria-hidden="true" class="header-anchor">#</a> 关于</h3> <h4 id="_1-column属性介绍，大家可以看源码，解析"><a href="#_1-column属性介绍，大家可以看源码，解析" aria-hidden="true" class="header-anchor">#</a> 1. Column属性介绍，大家可以看<a href="https://github.com/2881099/FreeSql/blob/f8c3608fdac2933b528605cc46b21b71c79eaacb/FreeSql/DataAnnotations/ColumnAttribute.cs" target="_blank" rel="noopener noreferrer">源码，解析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>1). 比如：Blog表中指定了Title为varchar(50),我们如何通过代码指定了主键，唯一值，字形。</p> <div class="language-c# extra-class"><pre class="language-text"><code>    public class Blog
    {
        [Column(IsIdentity = true, IsPrimary = true)]
        public int BlogId { get; set; }
        [Column(DbType = &quot;varchar(50)&quot;)]
        public string Title { get; set; }
    }
</code></pre></div><p>2). Column的命名空间在</p> <div class="language-c# extra-class"><pre class="language-text"><code>using FreeSql.DataAnnotations;
</code></pre></div><p>更多属性介绍</p> <table><thead><tr><th>字段</th> <th>备注</th></tr></thead> <tbody><tr><td>Name</td> <td>数据库列名</td></tr> <tr><td>OldName</td> <td>指定数据库旧的列名，修改实体属性命名时，同时设置此参数为修改之前的值，CodeFirst才可以正确修改数据库字段；否则将视为【新增字段】</td></tr> <tr><td>DbType</td> <td>数据库类型，如： varchar(255)</td></tr> <tr><td>IsPrimary</td> <td>主键</td></tr> <tr><td>IsIdentity</td> <td>自增标识</td></tr> <tr><td>IsNullable</td> <td>是否可DBNull</td></tr> <tr><td>IsIgnore</td> <td>忽略此列，不迁移、不插入</td></tr> <tr><td>IsVersion</td> <td>设置行锁（乐观锁）版本号，每次更新累加版本号，若更新整个实体时会附带当前的版本号判断（修改失败时抛出异常）</td></tr> <tr><td>DbDefautValue</td> <td>数据库默认值</td></tr> <tr><td>MapType</td> <td>类型映射，比如：可将 enum 属性映射成 typeof(string)</td></tr> <tr><td>Uniques</td> <td>唯一键，在多个属性指定相同的标识，代表联合键；可使用逗号分割多个 UniqueKey 名。</td></tr></tbody></table> <h4 id="_2-table-的使用：用于在类的上面指定这个表的属性"><a href="#_2-table-的使用：用于在类的上面指定这个表的属性" aria-hidden="true" class="header-anchor">#</a> 2. Table 的使用：用于在类的上面指定这个表的属性</h4> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token class-name">Table</span><span class="token punctuation">(</span>Name <span class="token operator">=</span> <span class="token string">&quot;t_blog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Blog</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>更多属性介绍</p> <table><thead><tr><th>字段</th> <th>备注</th></tr></thead> <tbody><tr><td>Name</td> <td>数据库表名</td></tr> <tr><td>OldName</td> <td>指定数据库旧的表名，修改实体命名时，同时设置此参数为修改之前的值，CodeFirst才可以正确修改数据库表；否则将视为【创建新表】</td></tr> <tr><td>SelectFilter</td> <td>查询过滤SQL，实现类似 a.IsDeleted = 1 功能</td></tr> <tr><td>DisableSyncStructure</td> <td>禁用 CodeFirst 同步结构迁移</td></tr></tbody></table> <h4 id="_3-其他的还是看-https-github-com-2881099-freesql-blob-master-docs-codefirst-md"><a href="#_3-其他的还是看-https-github-com-2881099-freesql-blob-master-docs-codefirst-md" aria-hidden="true" class="header-anchor">#</a> 3. 其他的还是看 https://github.com/2881099/FreeSql/blob/master/Docs/codefirst.md</h4> <h4 id="blog-cs"><a href="#blog-cs" aria-hidden="true" class="header-anchor">#</a> Blog.cs</h4> <div class="language-c# extra-class"><pre class="language-text"><code>using FreeSql.DataAnnotations;
using System;

namespace RESTful.FreeSql.Domain
{
    public class Blog
    {
        [Column(IsIdentity = true, IsPrimary = true)]
        public int BlogId { get; set; }
        [Column(DbType = &quot;varchar(50)&quot;)]
        public string Title { get; set; }
        [Column(DbType = &quot;varchar(500)&quot;)]
        public string Content { get; set; }
        public DateTime CreateTime { get; set; }


    }
}
</code></pre></div><h4 id="post-cs"><a href="#post-cs" aria-hidden="true" class="header-anchor">#</a> Post.cs</h4> <div class="language-C# extra-class"><pre class="language-text"><code>
using FreeSql.DataAnnotations;
using System;

namespace RESTful.FreeSql.Domain
{
    public class Post
    {
        [Column(IsIdentity = true, IsPrimary = true)]
        public int PostId { get; set; }
        [Column(DbType = &quot;varchar(50)&quot;)]
        public string ReplyContent { get; set; }
        public int BlogId { get; set; }
        public DateTime ReplyTime { get; set; }
        public Blog Blog { get; set; }
    }
}
</code></pre></div><h4 id="startup-cs"><a href="#startup-cs" aria-hidden="true" class="header-anchor">#</a> Startup.cs</h4> <p>非全部代码，这里注意点：要先在mysql中创建数据库<strong>FreeSql_Blog</strong>，否则一直提示<strong>主库xxxxx</strong>,官网未找到相关描述。</p> <p>这里初始化FreeSql，并使用单例模式，注入到默认的依赖中，这样在Controller中即可直接注入。</p> <div class="language-c# extra-class"><pre class="language-text"><code>namespace RESTful.FreeSql
{
    public class Startup
    {
        public Startup(IConfiguration configuration)
        {
            Fsql = new FreeSqlBuilder()
                        .UseConnectionString(DataType.MySql, @&quot;Data Source=127.0.0.1;Port=3306;User ID=root;Password=123456;Initial Catalog=FreeSql_Blog;Charset=utf8;SslMode=none;Max pool size=10&quot;)
                        .UseAutoSyncStructure(true)
                        .Build();
        }

        public IFreeSql Fsql { get; }

        public void ConfigureServices(IServiceCollection services)
        {
            services.AddSingleton&lt;IFreeSql&gt;(Fsql);

        }
    }
}
</code></pre></div><h4 id="blogcontroller"><a href="#blogcontroller" aria-hidden="true" class="header-anchor">#</a> BlogController</h4> <p>在controllers文件夹新建一个控制器BlogController</p> <div class="language-c# extra-class"><pre class="language-text"><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using FreeSql;
using Microsoft.AspNetCore.Mvc;
using RESTful.FreeSql.Domain;

namespace RESTful.FreeSql.Controllers
{
    [Route(&quot;api/[controller]&quot;)]
    [ApiController]
    public class BlogController : ControllerBase
    {
        // GET api/Blog

        IFreeSql _fsql;
        public BlogController(IFreeSql fsql)
        {
            _fsql = fsql;
        }

        [HttpGet]
        public ActionResult&lt;IEnumerable&lt;Blog&gt;&gt; Get()
        {
            List&lt;Blog&gt; blogs = _fsql.Select&lt;Blog&gt;().OrderByDescending(r =&gt; r.CreateTime).ToList();

            return blogs;
        }

        // GET api/blog/5
        [HttpGet(&quot;{id}&quot;)]
        public ActionResult&lt;Blog&gt; Get(int id)
        {
            return _fsql.Select&lt;Blog&gt;(id).ToOne();
        }


        // DELETE api/blog/5
        [HttpDelete(&quot;{id}&quot;)]
        public void Delete(int id)
        {
            _fsql.Delete&lt;Blog&gt;(new { BlogId = id }).ExecuteAffrows();
        }
    }
}
</code></pre></div><p>重新运行，打开地址 http://localhost:5001/api/blog 会发现数据库中生成了表blog，这时候表post并没有生成。所以我们判断，只有在访问到实体类才检查是否存在表结构，然后执行相应的处理。</p> <p>手动向blog表中加一些数据，然后再次请求</p> <ul><li>http://localhost:5001/api/blog， 可看到相应的数据。</li> <li>http://localhost:5001/api/blog/1  可得到单个数据。</li></ul> <h4 id="自动同步实体结构【开发环境必备】"><a href="#自动同步实体结构【开发环境必备】" aria-hidden="true" class="header-anchor">#</a> 自动同步实体结构【开发环境必备】</h4> <p>此功能默认为开启状态，发布正式环境后，请修改此设置</p> <div class="language- extra-class"><pre class="language-text"><code>Fsql = new FreeSqlBuilder()
          .UseConnectionString(DataType.MySql, @&quot;连接字符串&quot;)
          .UseAutoSyncStructure(true)
          .Build();
                      
//UseAutoSyncStructure(true/false)【开发环境必备】自动同步实体结构到数据库，程序运行中检查实体表是否存在，然后创建或修改

// 也可使用此方法指定是否自动同步结构。                  
Fsql.CodeFirst.IsAutoSyncStructure = true;
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">7/16/2019, 11:28:15 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/vuepress-docs/dotnetcore/examples/Console-News-Types.html" class="prev">
          .NET Core 简单测试项目
        </a></span> <span class="next"><a href="/vuepress-docs/dotnetcore/examples/FreeSql-sample-blog-RESTful-use-automapper.html">
          RESTful+FreeSql+AutoMapper
        </a>
        →
      </span></p></div> </div> <!----> <img src="" style="position:absolute;width:135px;left:calc(100% / 2 + 50px);bottom:10px;transform:translateX(-50%);"></div></div>
    <script src="/vuepress-docs/assets/js/app.3e2b6cdf.js" defer></script><script src="/vuepress-docs/assets/js/13.3d6fab59.js" defer></script>
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?c3446600de53c605ba4f6c792e47dff9";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  </body>
</html>
